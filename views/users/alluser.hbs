<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Users</title>
  <link href="/css/styles.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

</head>

<body class="w-full">
  {{>upperPart }}

  <div id="main" class="flex justify-center items-center px-4 md:p-10">
    <div id="users-list" class="w-full flex justify-center items-center">
      <div class="card !static bg-cyan-700 shadow-xl w-full sm:w-4/5 lg:h-auto lg:w-3/5 pb-3 lg:pb-0 mt-4">
        <div class="card-body p-4 lg:p-8 flex flex-col items-center w-full lg:justify-start lg:h-full lg:pl-8">
          <h2 class="card-title text-white font-extrabold text-2xl justify-center mt-2 mb-2">
            All users
          </h2>

          {{#if allUser.length}}
          <table id="users-table" class="block sm:table card !static text-left text-white text-lg bg-gray-800 w-full">
            <thead class="hidden sm:table-header-group">
              <tr class="text-center">
                <th class="p-4">User Info</th>
                <th class="p-4">Books (Available)</th>
                <th class="p-4">Trade Requests</th>
              </tr>
            </thead>
            <tbody class="block sm:table-row-group w-full">
              {{#each allUser}}
              <tr class="block sm:table-row border-b border-gray-600">
                <!-- User Info -->
                <td class="p-4 flex flex-col sm:flex-row items-center sm:text-left text-center w-full">
                  <i class="fas fa-user mb-2 sm:mb-0 sm:mr-3 text-lg"></i> <!-- User icon -->
                  <div>
                    <p class="font-bold text-lg">{{this.username}}</p>
                    <p class="text-sm font-normal">
                      {{#if this.city}}{{this.city}},{{/if}}
                      {{#if this.state}}{{this.state}},{{/if}}
                      {{#if this.address}}{{this.address}}{{/if}}
                    </p>
                  </div>
                </td>

                <!-- Books (Available) -->
                <td class="p-4 block sm:table-cell text-center w-full">
                  <i class="fas fa-book mr-2"></i> <!-- Book icon -->
                  <span>{{this.books.length}}</span> <!-- Total number of books -->
                  <span class="text-sm">(Available: {{this.availableBooksCount}})</span> <!-- Available books -->
                </td>

                <!-- Trade Requests -->
                <td class="p-4 block sm:table-cell text-center w-full">
                  <i class="fas fa-exchange-alt mr-2"></i> <!-- Trade icon -->
                  <span>{{this.receivedTradeRequests.length}}</span> <!-- Received trade requests -->
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>

          {{else}}
          <table id="empty-user-users" class="table !static text-center text-white text-lg bg-gray-800">
            <tr>
              <td class="p-4">No available users at the moment.</td>
            </tr>
          </table>
          {{/if}}
        </div>
      </div>
    </div>
  </div>

  {{>belowPart }}

  <script>
    // Ambil token dari cookie
    const cookieToken = document.cookie.split('; ').find(row => row.startsWith('token='));

    if (cookieToken) {
      // Parse token dari cookie
      const token = cookieToken.split('=')[1];

      // Simpan token ke dalam localStorage
      localStorage.setItem('jwtToken', token);

      // Hapus token dari cookie (opsional)
      document.cookie = 'token=; Max-Age=0;'; // Menetapkan waktu maksimum cookie ke 0 akan menghapusnya
    }
  </script>
</body>

</html>